"use strict";
var platform = require("platform");
var color_1 = require("color");
try {
    var ArgonPrivate = require('argon-private');
}
catch (e) { }
var Util = (function () {
    function Util() {
    }
    Util.canDecrypt = function () {
        return !!ArgonPrivate;
    };
    Util.decrypt = function (encryptedData) {
        if (!ArgonPrivate)
            return Promise.reject(new Error("This build of Argon is incapable of decrypting messages."));
        return Promise.resolve().then(function () {
            return ArgonPrivate.decrypt(encryptedData);
        });
    };
    Util.getInternalVuforiaKey = function () {
        return ArgonPrivate && ArgonPrivate.getVuforiaLicenseKey();
    };
    Util.bringToFront = function (view) {
        if (view.android) {
            view.android.bringToFront();
        }
        else if (view.ios) {
            view.ios.superview.bringSubviewToFront(view.ios);
        }
    };
    Util.linearGradient = function (view, colors) {
        var _colors = [];
        var nativeView = view['_nativeView'];
        if (!nativeView) {
            return;
        }
        colors.forEach(function (c, idx) {
            if (!(c instanceof color_1.Color)) {
                colors[idx] = new color_1.Color(c);
            }
        });
        if (platform.device.os === platform.platformNames.android) {
            var backgroundDrawable = nativeView.getBackground(), LINEAR_GRADIENT = 0;
            colors.forEach(function (c) {
                _colors.push(c.android);
            });
            if (!(backgroundDrawable instanceof android.graphics.drawable.GradientDrawable)) {
                backgroundDrawable = new android.graphics.drawable.GradientDrawable();
                backgroundDrawable.setColors(_colors);
                backgroundDrawable.setGradientType(LINEAR_GRADIENT);
                nativeView.setBackgroundDrawable(backgroundDrawable);
            }
        }
        else if (platform.device.os === platform.platformNames.ios) {
            var iosView = view.ios;
            var colorsArray = NSMutableArray.alloc().initWithCapacity(2);
            colors.forEach(function (c) {
                colorsArray.addObject(interop.types.id(c.ios.CGColor));
            });
            var gradientLayer = CAGradientLayer.layer();
            gradientLayer.colors = colorsArray;
            gradientLayer.frame = iosView.bounds;
            iosView.layer.insertSublayerAtIndex(gradientLayer, 0);
        }
    };
    return Util;
}());
exports.Util = Util;
function ipToString(inAddr) {
    if (!inAddr) {
        throw new Error('in == NULL');
    }
    if (inAddr.s_addr === 0x00000000) {
        return '*';
    }
    else {
        return NSString.stringWithCStringEncoding(inet_ntoa(inAddr), 1).toString();
    }
}
function getIPAddressOfInterface($interface) {
    var address = '-';
    if (!$interface) {
        return address;
    }
    var interfacesPtrPtr = new interop.Reference();
    if (getifaddrs(interfacesPtrPtr) === 0) {
        var interfacesPtr = interfacesPtrPtr[0];
        var temp_addrPtr = interfacesPtr;
        while (temp_addrPtr != null) {
            if (temp_addrPtr[0].ifa_addr[0].sa_family === 2) {
                var name = NSString.stringWithUTF8String(temp_addrPtr[0].ifa_name).toString().trim();
                if (NSString.stringWithUTF8String(temp_addrPtr[0].ifa_name).toString() == $interface) {
                    var ifa_addrPtr = temp_addrPtr[0].ifa_addr;
                    var ifa_addrPtrAsSockAddtr_in = new interop.Reference(sockaddr_in, ifa_addrPtr);
                    address = ipToString(ifa_addrPtrAsSockAddtr_in[0].sin_addr);
                }
            }
            temp_addrPtr = temp_addrPtr[0].ifa_next;
        }
        freeifaddrs(interfacesPtr);
    }
    return address;
}
exports.getIPAddressOfInterface = getIPAddressOfInterface;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLG1DQUFxQztBQUNyQywrQkFBNEI7QUFHNUIsSUFBSSxDQUFDO0lBQ0gsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzlDLENBQUM7QUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQztBQUVkO0lBQUE7SUFpRUEsQ0FBQztJQS9EUSxlQUFVLEdBQWpCO1FBQ0UsTUFBTSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7SUFDeEIsQ0FBQztJQUVNLFlBQU8sR0FBZCxVQUFlLGFBQW9CO1FBQ2pDLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1lBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsMERBQTBELENBQUMsQ0FBQyxDQUFBO1FBQy9HLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQzVCLE1BQU0sQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFBO1FBQzVDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLDBCQUFxQixHQUE1QjtRQUNFLE1BQU0sQ0FBQyxZQUFZLElBQUksWUFBWSxDQUFDLG9CQUFvQixFQUFFLENBQUM7SUFDN0QsQ0FBQztJQUVNLGlCQUFZLEdBQW5CLFVBQW9CLElBQVU7UUFDNUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUM5QixDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLG1C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QUMsQ0FBQztvQkFDbkYsSUFBSSxXQUFXLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztvQkFDM0MsSUFBSSx5QkFBeUIsR0FBRyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDO29CQUNoRixPQUFPLEdBQUcsVUFBVSxDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNoRSxDQUFDO1lBQ0wsQ0FBQztZQUNELFlBQVksR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO1FBQzVDLENBQUM7UUFFRCxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNELE1BQU0sQ0FBQyxPQUFPLENBQUM7QUFDbkIsQ0FBQztBQTNCRCwwREEyQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1ZpZXd9IGZyb20gXCJ1aS9jb3JlL3ZpZXdcIjtcbmltcG9ydCAqIGFzIHBsYXRmb3JtIGZyb20gXCJwbGF0Zm9ybVwiO1xuaW1wb3J0IHtDb2xvcn0gZnJvbSBcImNvbG9yXCI7XG5pbXBvcnQgKiBhcyBmaWxlIGZyb20gJ2ZpbGUtc3lzdGVtJ1xuXG50cnkge1xuICB2YXIgQXJnb25Qcml2YXRlID0gcmVxdWlyZSgnYXJnb24tcHJpdmF0ZScpO1xufSBjYXRjaCAoZSkge31cblxuZXhwb3J0IGNsYXNzIFV0aWwge1xuXG4gIHN0YXRpYyBjYW5EZWNyeXB0KCkgOiBib29sZWFuIHsgXG4gICAgcmV0dXJuICEhQXJnb25Qcml2YXRlO1xuICB9XG5cbiAgc3RhdGljIGRlY3J5cHQoZW5jcnlwdGVkRGF0YTpzdHJpbmcpIDogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoIUFyZ29uUHJpdmF0ZSkgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlRoaXMgYnVpbGQgb2YgQXJnb24gaXMgaW5jYXBhYmxlIG9mIGRlY3J5cHRpbmcgbWVzc2FnZXMuXCIpKVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpPT57XG4gICAgICByZXR1cm4gQXJnb25Qcml2YXRlLmRlY3J5cHQoZW5jcnlwdGVkRGF0YSlcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnRlcm5hbFZ1Zm9yaWFLZXkoKSA6IHN0cmluZ3x1bmRlZmluZWQge1xuICAgIHJldHVybiBBcmdvblByaXZhdGUgJiYgQXJnb25Qcml2YXRlLmdldFZ1Zm9yaWFMaWNlbnNlS2V5KCk7XG4gIH1cblxuICBzdGF0aWMgYnJpbmdUb0Zyb250KHZpZXc6IFZpZXcpIHtcbiAgICBpZiAodmlldy5hbmRyb2lkKSB7XG4gICAgICB2aWV3LmFuZHJvaWQuYnJpbmdUb0Zyb250KCk7XG4gICAgfSBlbHNlIGlmICh2aWV3Lmlvcykge1xuICAgICAgdmlldy5pb3Muc3VwZXJ2aWV3LmJyaW5nU3Vidmlld1RvRnJvbnQodmlldy5pb3MpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBsaW5lYXJHcmFkaWVudCh2aWV3OlZpZXcsIGNvbG9yczooQ29sb3J8c3RyaW5nKVtdKSB7XG4gICAgdmFyIF9jb2xvcnM6YW55W10gPSBbXTtcbiAgICB2YXIgbmF0aXZlVmlldyA9IHZpZXdbJ19uYXRpdmVWaWV3J107XG5cbiAgICBpZiAoIW5hdGl2ZVZpZXcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb2xvcnMuZm9yRWFjaChmdW5jdGlvbiAoYywgaWR4KSB7XG4gICAgICBpZiAoIShjIGluc3RhbmNlb2YgQ29sb3IpKSB7XG4gICAgICAgIGNvbG9yc1tpZHhdID0gbmV3IENvbG9yKGMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKHBsYXRmb3JtLmRldmljZS5vcyA9PT0gcGxhdGZvcm0ucGxhdGZvcm1OYW1lcy5hbmRyb2lkKSB7XG4gICAgICB2YXIgYmFja2dyb3VuZERyYXdhYmxlID0gbmF0aXZlVmlldy5nZXRCYWNrZ3JvdW5kKCksXG4gICAgICAgIExJTkVBUl9HUkFESUVOVCA9IDA7XG5cbiAgICAgIGNvbG9ycy5mb3JFYWNoKGZ1bmN0aW9uIChjOkNvbG9yKSB7XG4gICAgICAgIF9jb2xvcnMucHVzaChjLmFuZHJvaWQpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmICghKGJhY2tncm91bmREcmF3YWJsZSBpbnN0YW5jZW9mIGFuZHJvaWQuZ3JhcGhpY3MuZHJhd2FibGUuR3JhZGllbnREcmF3YWJsZSkpIHtcbiAgICAgICAgYmFja2dyb3VuZERyYXdhYmxlID0gbmV3IGFuZHJvaWQuZ3JhcGhpY3MuZHJhd2FibGUuR3JhZGllbnREcmF3YWJsZSgpO1xuICAgICAgICBiYWNrZ3JvdW5kRHJhd2FibGUuc2V0Q29sb3JzKF9jb2xvcnMpO1xuICAgICAgICBiYWNrZ3JvdW5kRHJhd2FibGUuc2V0R3JhZGllbnRUeXBlKExJTkVBUl9HUkFESUVOVCk7XG4gICAgICAgIG5hdGl2ZVZpZXcuc2V0QmFja2dyb3VuZERyYXdhYmxlKGJhY2tncm91bmREcmF3YWJsZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChwbGF0Zm9ybS5kZXZpY2Uub3MgPT09IHBsYXRmb3JtLnBsYXRmb3JtTmFtZXMuaW9zKSB7XG4gICAgICB2YXIgaW9zVmlldzpVSVZpZXcgPSB2aWV3LmlvcztcbiAgICAgIHZhciBjb2xvcnNBcnJheSA9IE5TTXV0YWJsZUFycmF5LmFsbG9jKCkuaW5pdFdpdGhDYXBhY2l0eSgyKTtcbiAgICAgIGNvbG9ycy5mb3JFYWNoKGZ1bmN0aW9uIChjOkNvbG9yKSB7XG4gICAgICAgIGNvbG9yc0FycmF5LmFkZE9iamVjdChpbnRlcm9wLnR5cGVzLmlkKGMuaW9zLkNHQ29sb3IpKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGdyYWRpZW50TGF5ZXIgPSBDQUdyYWRpZW50TGF5ZXIubGF5ZXIoKTtcbiAgICAgIGdyYWRpZW50TGF5ZXIuY29sb3JzID0gY29sb3JzQXJyYXk7XG4gICAgICBncmFkaWVudExheWVyLmZyYW1lID0gaW9zVmlldy5ib3VuZHM7XG4gICAgICBpb3NWaWV3LmxheWVyLmluc2VydFN1YmxheWVyQXRJbmRleChncmFkaWVudExheWVyLCAwKTtcbiAgICB9XG4gIH1cbn1cblxuZGVjbGFyZSBjb25zdCBpbmV0X250b2E6YW55O1xuZGVjbGFyZSBjb25zdCBnZXRpZmFkZHJzOmFueTtcbmRlY2xhcmUgY29uc3Qgc29ja2FkZHJfaW46YW55O1xuZGVjbGFyZSBjb25zdCBmcmVlaWZhZGRyczphbnk7XG5cbmZ1bmN0aW9uIGlwVG9TdHJpbmcoaW5BZGRyKSB7XG4gICAgaWYgKCFpbkFkZHIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbiA9PSBOVUxMJyk7XG4gICAgfVxuXG4gICAgaWYgKGluQWRkci5zX2FkZHIgPT09IDB4MDAwMDAwMDApIHtcbiAgICAgICAgcmV0dXJuICcqJztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTlNTdHJpbmcuc3RyaW5nV2l0aENTdHJpbmdFbmNvZGluZyhpbmV0X250b2EoaW5BZGRyKSwgMSkudG9TdHJpbmcoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJUEFkZHJlc3NPZkludGVyZmFjZSgkaW50ZXJmYWNlKSB7XG4gICAgdmFyIGFkZHJlc3MgPSAnLSc7XG4gICAgaWYgKCEkaW50ZXJmYWNlKSB7XG4gICAgICAgIHJldHVybiBhZGRyZXNzO1xuICAgIH1cblxuICAgIHZhciBpbnRlcmZhY2VzUHRyUHRyID0gbmV3IGludGVyb3AuUmVmZXJlbmNlKCk7XG5cbiAgICBpZiAoZ2V0aWZhZGRycyhpbnRlcmZhY2VzUHRyUHRyKSA9PT0gMCkge1xuICAgICAgICB2YXIgaW50ZXJmYWNlc1B0ciA9IGludGVyZmFjZXNQdHJQdHJbMF07XG4gICAgICAgIHZhciB0ZW1wX2FkZHJQdHIgPSBpbnRlcmZhY2VzUHRyO1xuXG4gICAgICAgIHdoaWxlICh0ZW1wX2FkZHJQdHIgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHRlbXBfYWRkclB0clswXS5pZmFfYWRkclswXS5zYV9mYW1pbHkgPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IE5TU3RyaW5nLnN0cmluZ1dpdGhVVEY4U3RyaW5nKHRlbXBfYWRkclB0clswXS5pZmFfbmFtZSkudG9TdHJpbmcoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgaWYgKE5TU3RyaW5nLnN0cmluZ1dpdGhVVEY4U3RyaW5nKHRlbXBfYWRkclB0clswXS5pZmFfbmFtZSkudG9TdHJpbmcoKSA9PSAkaW50ZXJmYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpZmFfYWRkclB0ciA9IHRlbXBfYWRkclB0clswXS5pZmFfYWRkcjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlmYV9hZGRyUHRyQXNTb2NrQWRkdHJfaW4gPSBuZXcgaW50ZXJvcC5SZWZlcmVuY2Uoc29ja2FkZHJfaW4sIGlmYV9hZGRyUHRyKTtcbiAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyA9IGlwVG9TdHJpbmcoaWZhX2FkZHJQdHJBc1NvY2tBZGR0cl9pblswXS5zaW5fYWRkcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGVtcF9hZGRyUHRyID0gdGVtcF9hZGRyUHRyWzBdLmlmYV9uZXh0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnJlZWlmYWRkcnMoaW50ZXJmYWNlc1B0cik7XG4gICAgfVxuICAgIHJldHVybiBhZGRyZXNzO1xufSJdfQ==